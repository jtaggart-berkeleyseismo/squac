<div *ngIf="dashboard" id="dashboard-container">
    <mat-toolbar id="dashboard-header" >
      <div id="dashboard-info">
          <h2>
              {{dashboard.name}}
          </h2>
          <!-- TODO: add dashboard owner name & copy -->
      </div>
        <div id="header-controls">
          <button mat-flat-button color="accent" (click)="saveDashboard()" *ngIf="unsaved">
            <mat-icon >save</mat-icon>
            Save
          </button>
          <button mat-icon-button (click)="refreshData()" color="primary" aria-label="refresh data">
              <mat-icon >refresh</mat-icon>  
          </button>
          <mat-form-field id="date-range">
              <mat-select 
                [(value)]="selectedDateRange"
                (selectionChange)="selectDateRange($event)"
                >
                <mat-option *ngFor="let range of dateRanges"
                  [value]="range"
                >
                  {{range.name}}
                </mat-option>
              </mat-select>
          </mat-form-field>

          <!-- if they have permission, otherwise show copy only -->
          <mat-menu #appMenu="matMenu" class="mat-menu-dense" yPosition="below" xPosition="before">
            <button mat-menu-item (click)="addWidget()" >Add Widget</button> 
            <button mat-menu-item (click)="editDashboard()">Edit Dashboard Information</button>
            <!-- <button mat-menu-item color="warn" *ngIf="'dashboard' | can: 'delete'">Delete Dashboard</button> -->
          </mat-menu>
          
          <button mat-icon-button [matMenuTriggerFor]="appMenu" color="primary" *ngIf="dashboard | can: 'update'">
            <mat-icon>settings_application</mat-icon>
          </button>
        </div>

      </mat-toolbar>
      <mat-progress-bar
        *ngIf="status != 'finished'"
        [mode]="status != 'error' ? 'indeterminate' : 'determinate'"
        value = "1001"
        [color]="status == 'error' ? 'warn' : 'primary'"

        >
      </mat-progress-bar>

      <app-error [error]="error">

      </app-error>
      <ng-container *ngIf="dashboard.widgetIds.length > 0; else noWidgets">
        <app-widget >
        </app-widget>
      </ng-container>
      <ng-template #noWidgets>
        <div id="add-widget">
          <p>
            There are no widgets for this dashboard...
          </p>
          <button  mat-flat-button color="accent" aria-label="Add widget" (click)="addWidget()" *ngIf="'Dashboard' | can: 'update'">
            Add Widget
          </button>
        </div>

      </ng-template>

</div>

<app-loading *ngIf="!dashboard"></app-loading>

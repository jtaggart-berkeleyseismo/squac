<h1>
  {{editMode ? "Edit Channel Group" : "Create Channel Group"}}
</h1>

<div id="selection-container">
  <div id="map-box" class="box">
    <app-map [channels]="mapChannels" [editPage]=true (boundsChange)="updateBounds($event)"></app-map>
  </div>

  <div id="available-channels" class="box">
    <h3 class="help-text">Search for channels matching:</h3>
    <app-channel-groups-filter id="filter" (filtersChanged)="getChannelsWithFilters($event)"> 
    </app-channel-groups-filter>
    <h4>Selection Preview</h4>
    <!-- <app-loading *ngIf="loading"></app-loading> -->
    <app-loading *ngIf="loading"></app-loading>
    <div class="table-container">
      <ngx-datatable 
        #availableTable
        id="channel-selector"
        class="material" 
        [rows]="availableChannels" 
        [columnMode]="ColumnMode.force"
        [headerHeight]="50" 
        [footerHeight]="50" 
        [rowHeight]="40"
        [scrollbarV]="true"
        rowHeight="auto" 
        [limit]="9" 
        [sortType]="SortType.multi"
        >
        <ngx-datatable-column name="Network" [draggable]="false" [sortable]="true" [resizeable]="false" [width]="100">
          <ng-template let-row="row" ngx-datatable-cell-template>
            {{ row.networkCode }}
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column name="Station" [draggable]="false" [sortable]="true" [resizeable]="false" [width]="100">
          <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
            {{row.stationCode}}
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column name="Location" [draggable]="false" [sortable]="true" [resizeable]="false" [width]="100">
          <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
            {{row.loc}}
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column name="Channel" [draggable]="false" [sortable]="true" [resizeable]="false" [width]="100">
          <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
            {{row.code}}
          </ng-template>
        </ngx-datatable-column>
      </ngx-datatable>
      <button mat-raised-button color="accent" (click)="addChannelsToSelected()" 
        [disabled]="!availableChannels || availableChannels.length === 0">
        Add Channels
      </button>
    </div>
  </div>
  
  <div id="selected-channels" class="box">
    <form class="" [formGroup]="channelGroupForm">
      <mat-form-field class="channel-group-input">
        <input matInput placeholder="Channel Group Name" formControlName="name">
      </mat-form-field>
      <mat-form-field class="channel-group-input">
        <textarea matInput placeholder="Channel Group Description" formControlName="description"></textarea>
      </mat-form-field>
      <h3>Selected Channels</h3>
      <p class="help-text">These channels will appear on your widget.</p>
      <!-- <app-channel-groups-filter (filtersChanged)="removeChannelsWithFilters($event)">
      
        </app-channel-groups-filter> -->
      <ngx-datatable 
        #selectedTable
        id="group-channels"
        class="material" 
        [rows]="selectedChannels"
        [columnMode]="ColumnMode.force"
        [headerHeight]="50"
        [footerHeight]="50" 
        [rowHeight]="40"
        [scrollbarV]="true"
        rowHeight="auto" 
        [selected]="selectedChannels"
        [selectionType]="SelectionType.checkbox" 
        (select)="onSelect($event)"
        >
        <ngx-datatable-column [width]="50" [sortable]="false" [canAutoResize]="false" [draggable]="false"
        [resizeable]="false">
          <ng-template ngx-datatable-header-template let-value="value">
          </ng-template>
          <ng-template ngx-datatable-cell-template let-value="value" let-row="row">
            <button (click)="removeChannel(row)">X</button>
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column name="Network" [draggable]="false" [sortable]="false" [resizeable]="false" [width]="100">
          <ng-template let-row="row" ngx-datatable-cell-template>
            {{ row.networkCode }}
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column name="Station" [draggable]="false" [sortable]="false" [resizeable]="false" [width]="100">
          <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
            {{ row.stationCode }}
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column name="Location" [draggable]="false" [sortable]="true" [resizeable]="false" [width]="100">
            <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
              {{row.loc}}
            </ng-template>
          </ngx-datatable-column>
        <ngx-datatable-column name="Channel" [draggable]="false" [sortable]="false" [resizeable]="false" [width]="100">
          <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
            {{ row.code }}
          </ng-template>
        </ngx-datatable-column>
      </ngx-datatable>
      <button mat-raised-button color="primary" (click)="formUnsaved()">
        Cancel
      </button>
      <button mat-raised-button color="accent" (click)="save()" [disabled]="selectedChannels?.length === 0">
        Save Group
      </button>
    </form>
  </div>
  <div id="channel-group-popup" class="popup">
    <div id="channel-group-popup-box" class="box popup-box">
      <p>Your new metric will not be saved.<br/>
      Would you like to continue?</p>
      <div class="btn-container">
        <button mat-raised-button color="primary" 
          (click)="closePopup()"
        >Cancel</button>
        <button mat-raised-button color="accent"
        (click)="cancel()"  
        >Continue</button>
      </div>
    </div>
  </div>
</div>
